//
// Copyright (C) 2015 エヌ・ティ・ティ アイティ株式会社
// 著作者の許可なく変更・配布を禁止します。
//
// speechrec.js
// ver 1.3.3.1
//

//
// Copyright (C) 2015 エヌ・ティ・ティ コミュニケーションズ株式会社
//

var SpeechRec=window.SpeechRec={};SpeechRec._client_version="speechrec.js-1.3.3.0";SpeechRec.BASE_URL="wss://speechrec.skyway.io/recognize";SpeechRec.SRP_H5_URL="wss://speechrec.skyway.io/recognize";SpeechRec.USER_AGENT="SpeechRecClientWS/1.0";SpeechRec.SKYWAY_URL="https://skyway.io/ds/speechrec/token/";SpeechRec.DEFAULT_CONFIG={SkyWayKey:"",ApiKey:"",OpusWorkerUrl:"libopus.worker.js",NrFlag:!0,SbmMode:2,"Recg:Nbest":0,mic_recorder_port:2001,buffer_size_as_seconds:60,"SRL:UserDefine":"",TooLongAbort:!1,ContinuousMode:!1};
SpeechRec.is_little_endian=!!(new Uint8Array((new Uint16Array([1])).buffer))[0];navigator.getUserMedia?SpeechRec.user_media="getUserMedia":navigator.webkitGetUserMedia?(navigator.getUserMedia=navigator.webkitGetUserMedia,SpeechRec.user_media="webkitGetUserMedia"):navigator.mozGetUserMedia?(navigator.getUserMedia=navigator.mozGetUserMedia,SpeechRec.user_media="mozGetUserMedia"):SpeechRec.user_media="";
window.AudioContext||(window.webkitAudioContext?window.AudioContext=window.webkitAudioContext:window.mozAudioContext&&(window.AudioContext=window.mozAudioContext));SpeechRec.is_chrome=function(){return navigator.getUserMedia?!0:!1};SpeechRec._availability_message="-";SpeechRec.availability_message=function(){return SpeechRec._availability_message};
SpeechRec.availability=function(){if(!navigator.getUserMedia)return SpeechRec._availability_message="navigator.getUserMedia is unavailable",!1;if(!AudioContext)return SpeechRec._availability_message="AudioContext is unavailable",!1;if(!WebSocket)return SpeechRec._availability_message="WebSocket is unavailable",!1;if(!Worker)return SpeechRec._availability_message="Worker is unavailable",!1;if(!ArrayBuffer)return SpeechRec._availability_message="ArrayBuffer is unavailable",!1;if(!DataView)return SpeechRec._availability_message=
"DataView is unavailable",!1;if(!Float32Array)return SpeechRec._availability_message="Float32Array is unavailable",!1;if(!Uint8Array)return SpeechRec._availability_message="Uint8Array is unavailable",!1;if(!Int16Array)return SpeechRec._availability_message="Int16Array is unavailable",!1;if(!Int8Array)return SpeechRec._availability_message="Int8Array is unavailable",!1;SpeechRec._availability_message="okay maybe";return!0};SpeechRec.is_mute=!1;SpeechRec._fn={};
SpeechRec._fn.is_boolean=function(a){return"boolean"===typeof a||a instanceof Boolean?!0:!1};SpeechRec._fn.is_number=function(a){return"number"===typeof a||a instanceof Number?!0:!1};SpeechRec._fn.is_string=function(a){return"string"===typeof a||a instanceof String?!0:!1};
SpeechRec._fn.is_simple_hash=function(a){if("object"!==typeof a||null===a||a instanceof Boolean||a instanceof Number||a instanceof String||a instanceof Array)return!1;for(var c in a){if(!SpeechRec._fn.is_string(c))return!1;var b=a[c];if(!SpeechRec._fn.is_boolean(b)&&!SpeechRec._fn.is_number(b)&&!SpeechRec._fn.is_string(b))return!1}return!0};SpeechRec._timer={};SpeechRec._cb={};SpeechRec._cb._fn={};
SpeechRec._cb.all=function(a,c){if(!SpeechRec._fn.is_string(a)){var b={name:"fatal_error",errno:20001};b.message="_cb.all NG (! _fn.is_string(cb_name)): "+JSON.stringify(a);SpeechRec._cb.all("error",b)}else if(a in SpeechRec._cb._fn)if(SpeechRec._cb._fn[a]instanceof Array)for(b=0;b<SpeechRec._cb._fn[a].length;b++)SpeechRec._cb._fn[a][b](c);else b={name:"fatal_error",errno:20002},b.message="_cb.all NG (! (_cb._fn["+a+"] instanceof Array)): "+JSON.stringify(SpeechRec._cb._fn[a]),SpeechRec._cb.all("error",
b)};
SpeechRec._cb.add=function(a,c){if(SpeechRec._fn.is_string(a))c instanceof Function?(a in SpeechRec._cb._fn||(SpeechRec._cb._fn[a]=[]),SpeechRec._cb._fn[a]instanceof Array?SpeechRec._cb._fn[a].push(c):(b={name:"fatal_error",errno:20005},b.message="_cb.add NG (! (_cb._fn[cb_name] instanceof Array)): "+JSON.stringify(SpeechRec._cb._fn[a]),SpeechRec._cb.all("error",b))):(b={name:"fatal_error",errno:20004},b.message="_cb.add NG (! (cb_fn instanceof Function)): "+JSON.stringify(c),SpeechRec._cb.all("error",b));
else{var b={name:"fatal_error",errno:20003};b.message="_cb.add NG (! _fn.is_string(cb_name)): "+JSON.stringify(a);SpeechRec._cb.all("error",b)}};SpeechRec._cb.del=function(a){if(SpeechRec._fn.is_string(a))SpeechRec._cb._fn[a]=[];else{var c={name:"fatal_error",errno:20006};c.message="_cb.del NG (! _fn.is_string(cb_name)): "+JSON.stringify(a);SpeechRec._cb.all("error",c)}};SpeechRec.on_error=function(a){SpeechRec._cb.add("error",a)};SpeechRec.on_config=function(a){SpeechRec._cb.add("config",a)};
SpeechRec.on_start=function(a){SpeechRec._cb.add("start",a)};SpeechRec.on_stop=function(a){SpeechRec._cb.add("stop",a)};SpeechRec.on_ask=function(a){SpeechRec._cb.add("ask",a)};SpeechRec.on_allow=function(a){SpeechRec._cb.add("allow",a)};SpeechRec.on_deny=function(a){SpeechRec._cb.add("deny",a)};SpeechRec.on_voiceless=function(a){SpeechRec._cb.add("voiceless",a)};SpeechRec.on_voice_begin=function(a){SpeechRec._cb.add("voice_begin",a)};
SpeechRec.on_voice_too_long=function(a){SpeechRec._cb.add("voice_too_long",a)};SpeechRec.on_voice_end=function(a){SpeechRec._cb.add("voice_end",a)};SpeechRec.on_no_result=function(a){SpeechRec._cb.add("no_result",a)};SpeechRec.on_result=function(a){SpeechRec._cb.add("result",a)};SpeechRec.on_mic_enabled=function(a){SpeechRec._cb.add("mic_enabled",a)};SpeechRec.on_mic_disabled=function(a){SpeechRec._cb.add("mic_disabled",a)};SpeechRec.on_proc=function(a){SpeechRec._cb.add("proc",a)};
SpeechRec.on_audio_pressure_level=function(a){SpeechRec._cb.add("audio_pressure_level",a)};SpeechRec.on_state_changed=function(a){SpeechRec._cb.add("state_changed",a)};SpeechRec.on_send=function(a){SpeechRec._cb.add("send",a)};SpeechRec.on_recv=function(a){SpeechRec._cb.add("recv",a)};SpeechRec.CLIENT_STATE={ASKING:void 0,ALLOW:void 0,DENY:void 0,START:void 0,STOP:void 0,"(CHANGING)":void 0,"(IN ERROR)":void 0};
SpeechRec.WebAudio=function(){this._jsnode=this._source=this._context=this._stream=this._on_pcm=void 0;this._skip_data=!0;this._state="ASK";return this};
SpeechRec.WebAudio.prototype.initialize=function(a){a=a||{};if(!(a.on_pcm instanceof Function))throw{name:"fatal_error",errno:20007,message:"\u30af\u30e9\u30a4\u30a2\u30f3\u30c8\u90e8(\u30de\u30a4\u30af)\u306e\u521d\u671f\u5316\u306b\u5931\u6557\u3057\u307e\u3057\u305f (option.on_pcm\u306b\u306f\u95a2\u6570\u3092\u6307\u5b9a\u3057\u3066\u4e0b\u3055\u3044)"};void 0!==this._on_pcm&&delete this._on_pcm;this._on_pcm=a.on_pcm;void 0!==this._jsnode&&(void 0!==this._jsnode.onaudioprocess&&delete this._jsnode.onaudioprocess,
delete this._jsnode);this._jsnode=void 0;void 0!==this._context&&delete this._context;this._context=void 0;void 0!==this._source&&delete this._source;this._source=void 0;void 0!==this._stream&&delete this._stream;this._stream=void 0;this._skip_data=!0;this._state="ASK"};SpeechRec.WebAudio.prototype.state=function(){var a=[];void 0===this._stream?a.push("ASK"):null===this._stream?a.push("DENY"):a.push("ALLOW");this._skip_data&&a.push("SKIP");return a};
SpeechRec.WebAudio.prototype._set_stream=function(a){this._stream=a};SpeechRec.WebAudio.prototype.skip_data=function(){return this._skip_data};SpeechRec.WebAudio.prototype.ask=function(a,c){void 0===this._stream?navigator.getUserMedia({audio:!0},function(b){SpeechRec._cwa._set_stream(b);SpeechRec._state_changed();a instanceof Function&&a()},function(a){SpeechRec._cwa._set_stream(null);SpeechRec._state_changed();c instanceof Function&&c()}):a instanceof Function&&a()};
SpeechRec.WebAudio.prototype.open=function(a){!1!==this._skip_data&&(void 0===this._context&&(this._context=new window.AudioContext,this._source=this._context.createMediaStreamSource(this._stream),this._context.createScriptProcessor=this._context.createScriptProcessor||this._context.createJavaScriptNode,this._jsnode=this._context.createScriptProcessor(2048,1,1),this._jsnode._resampler=new SpeexResampler(1,this._context.sampleRate,16E3,32,!0,10),this._jsnode._on_pcm=this._on_pcm,this._jsnode.onaudioprocess=
function(a){if("START"===SpeechRec._state&&!SpeechRec._cwa.skip_data()&&this._on_pcm instanceof Function&&a){a=a.inputBuffer.getChannelData(0);var b=this._resampler.process(a)[0];a=new Float32Array(b.length);a.set(b);for(var b=new Int16Array(a.length),d=0;d<a.length;d++){var e=Math.max(-1,Math.min(1,a[d]));b[d]=0>e?32768*e:32767*e}this._on_pcm(b)}},this._source.connect(this._jsnode),this._jsnode.connect(this._context.destination)),this._skip_data=!1,SpeechRec._state_changed());a instanceof Function&&
a()};SpeechRec.WebAudio.prototype.close=function(a){!0!==this._skip_data&&(this._skip_data=!0,SpeechRec._state_changed());a instanceof Function&&a()};SpeechRec.WebSocket=function(a){this._name=a;this._ws=this._callbacks=this._url=this._on_error=void 0;return this};
SpeechRec.WebSocket.prototype.initialize=function(a){a=a||{};if(!(a.on_error instanceof Function)){var c={name:"fatal_error",errno:20008};c.message=this._name+"\u306e\u521d\u671f\u5316\u306b\u5931\u6557\u3057\u307e\u3057\u305f (option.on_error\u306b\u306f\u95a2\u6570\u3092\u6307\u5b9a\u3057\u3066\u304f\u3060\u3055\u3044)";throw c;}void 0!==this._on_error&&delete this._on_error;this._on_error=a.on_error;SpeechRec._fn.is_string(a.url)||(c={name:"fatal_error",errno:20009},c.message=this._name+"\u306e\u521d\u671f\u5316\u306b\u5931\u6557\u3057\u307e\u3057\u305f (option.url\u306b\u306f\u6587\u5b57\u5217\u3092\u6307\u5b9a\u3057\u3066\u4e0b\u3055\u3044)",
this._on_error(c));if(void 0===a.callbacks)a.callbacks=[];else{"object"!==typeof a.callbacks&&(c={name:"fatal_error",errno:20010},c.message=this._name+"\u306e\u521d\u671f\u5316\u306b\u5931\u6557\u3057\u307e\u3057\u305f (option.callbacks\u306b\u306f\u30cf\u30c3\u30b7\u30e5\u3092\u6307\u5b9a\u3057\u3066\u4e0b\u3055\u3044)",this._on_error(c));for(var b in a.callbacks)SpeechRec._fn.is_string(b)||(c={name:"fatal_error",errno:20011},c.message=this._name+"\u306e\u521d\u671f\u5316\u306b\u5931\u6557\u3057\u307e\u3057\u305f (option.callbacks\u30cf\u30c3\u30b7\u30e5\u306e\u30ad\u30fc\u306b\u306f\u6587\u5b57\u5217\u3092\u6307\u5b9a\u3057\u3066\u4e0b\u3055\u3044)",
this._on_error(c)),a.callbacks[b]instanceof Function||(c={name:"fatal_error",errno:20012},c.message=this._name+"\u306e\u521d\u671f\u5316\u306b\u5931\u6557\u3057\u307e\u3057\u305f (option.callbacks\u30cf\u30c3\u30b7\u30e5\u306e\u5024\u306b\u306f\u95a2\u6570\u3092\u6307\u5b9a\u3057\u3066\u4e0b\u3055\u3044)",this._on_error(c))}void 0!==this._callbacks&&delete this._callbacks;this._callbacks=a.callbacks;void 0!==this._ws&&delete this._ws;this._ws=void 0};
SpeechRec.WebSocket.prototype.state=function(){var a=[];void 0!==this.url&&a.push(this.url);void 0===this._ws?a.push("close"):a.push("open");var c=[];if(void 0!==this._ws){for(var b in this._ws._callbacks)c.push(b);for(b in this._ws._one_time_callback)c.push(b)}a.push(c);return a};
SpeechRec.WebSocket.prototype.open=function(a){if(this._ws instanceof WebSocket)a instanceof Function&&a();else{try{this._ws=new WebSocket(this._url)}catch(c){a={name:"WebSocket_error",errno:23E3};a.message=this._name+"\u3068\u306e\u63a5\u7d9a\u306b\u5931\u6557\u3057\u307e\u3057\u305f("+JSON.stringify(c)+")";this._on_error(a);return}this._ws.binaryType="arraybuffer";this._ws._name=this._name;this._ws._last_proc="new WebSocket("+this._url+");";this._ws._on_error=this._on_error;this._ws._callbacks=
this._callbacks;this._ws._callbacks.error=this._on_error;this._ws._one_time_callback={};this._ws.onmessage=this.on_message;this._ws._on_error=this._on_error;this._ws.onerror=function(a){var c={};void 0!==this._last_proc?(c.name="WebSocket_error",c.errno=23001,c.message=this._name+"\u3068\u306e\u63a5\u7d9a\u306b\u5931\u6557\u3057\u307e\u3057\u305f",delete this._last_proc):SpeechRec._fn.is_string(a.name)&&SpeechRec._fn.is_string(a.message)?(c.name="WebSocket_error",c.errno=23002,c.message=this._name+
"\u3067\u30a8\u30e9\u30fc\u304c\u767a\u751f\u3057\u307e\u3057\u305f("+JSON.stringify({name:a.name,message:a.message})+")"):(c.name="WebSocket_error",c.errno=23003,c.message=this._name+"\u3067\u30a8\u30e9\u30fc\u304c\u767a\u751f\u3057\u307e\u3057\u305f("+JSON.stringify(a)+")");this._on_error(c)};this._ws._on_open=a;this._ws.onopen=function(){delete this._last_proc;this.onclose=function(){this._closed=!0;var a={name:"WebSocket_error",errno:23004};a.message=this._name+"\u304b\u3089\u5207\u65ad\u3055\u308c\u307e\u3057\u305f";
this._on_error(a)};this._on_open instanceof Function&&this._on_open();SpeechRec._state_changed()}}};
SpeechRec.WebSocket.prototype.close=function(a){this._ws instanceof WebSocket?this._ws._closed?(SpeechRec._state_changed(),a instanceof Function&&a(),delete this._ws,this._ws=void 0):(this._ws.onclose=function(){},delete this._ws.onclose,this._ws.close(),delete this._ws,this._ws=void 0,SpeechRec._state_changed(),a instanceof Function&&a()):(SpeechRec._state_changed(),a instanceof Function&&a(),delete this._ws,this._ws=void 0)};
SpeechRec.WebSocket.prototype._send=function(a){if(this._ws instanceof WebSocket){var c=msgpack.pack(a),c=new Uint8Array(c);this._ws._closed||(SpeechRec._cb.all("send",{name:this._name,unpacked:a}),this._ws.send(c))}};
SpeechRec.WebSocket.prototype.on_message=function(a){if(a)if(a.data)if(a=new Uint8Array(a.data),130===a[0]){var c=msgpack.unpack(a);SpeechRec._cb.all("recv",{name:this._name,unpacked:c});if(c instanceof Object)if("key"in c)if("value"in c){a=c.key;var b=c.value;SpeechRec._fn.is_string(a)?(("configured"===a||"result"===a||"error"===a)&&SpeechRec._fn.is_string(b)&&(b=JSON.parse(b)),"error"===a&&(d={},SpeechRec._fn.is_string(b.name)&&SpeechRec._fn.is_string(b.message)?(d.name=b.name,d.errno=b.errno,d.message=
b.message):(d.name="runtime_error",d.errno=21E3,d.message=this._name+"\u304b\u3089\u30a8\u30e9\u30fc\u304c\u901a\u77e5\u3055\u308c\u307e\u3057\u305f("+JSON.stringify(b)+")"),b=d),a in this._callbacks?(c=this._callbacks[a],c(b)):a in this._one_time_callback?(c=this._one_time_callback[a],delete this._one_time_callback[a],c(b),void 0!==SpeechRec._timer[a]&&(clearTimeout(SpeechRec._timer[a]),delete SpeechRec._timer[a])):console.warn(this._name+"\u304c\u4e0d\u9069\u5207\u306a\u30e1\u30c3\u30bb\u30fc\u30b8\u3092\u53d7\u4fe1\u3057\u305f\u305f\u3081\u7121\u8996\u3057\u307e\u3057\u305f: "+
JSON.stringify(c))):(d={name:"invalid_message",errno:24005},d.message=this._name+"\u304b\u3089\u4e0d\u6b63\u306a\u30e1\u30c3\u30bb\u30fc\u30b8\u3092\u53d7\u4fe1\u3057\u307e\u3057\u305f (type5): "+JSON.stringify(c),this._on_error(d))}else d={name:"invalid_message",errno:24004},d.message=this._name+"\u304b\u3089\u4e0d\u6b63\u306a\u30e1\u30c3\u30bb\u30fc\u30b8\u3092\u53d7\u4fe1\u3057\u307e\u3057\u305f (type4): "+JSON.stringify(c),this._on_error(d);else d={name:"invalid_message",errno:24003},d.message=
this._name+"\u304b\u3089\u4e0d\u6b63\u306a\u30e1\u30c3\u30bb\u30fc\u30b8\u3092\u53d7\u4fe1\u3057\u307e\u3057\u305f (type3): "+JSON.stringify(c),this._on_error(d);else d={name:"invalid_message",errno:24002},d.message=this._name+"\u304b\u3089\u4e0d\u6b63\u306a\u30e1\u30c3\u30bb\u30fc\u30b8\u3092\u53d7\u4fe1\u3057\u307e\u3057\u305f (type2): "+JSON.stringify(c),this._on_error(d)}else 4<=a.length&&80==a[0]&&67==a[1]&&77==a[2]&&58==a[3]?"pcm"in this._one_time_callback?(c=this._one_time_callback.pcm,delete this._one_time_callback.pcm,
c(a)):console.warn(this._name+"\u304c\u4e0d\u9069\u5207\u306a\u30bf\u30a4\u30df\u30f3\u30b0\u3067PCM\u30c7\u30fc\u30bf\u3092\u53d7\u4fe1\u3057\u305f\u305f\u3081\u7121\u8996\u3057\u307e\u3057\u305f"):(d={name:"invalid_message",errno:24006},d.message=this._name+"\u304b\u3089\u4e0d\u6b63\u306a\u30e1\u30c3\u30bb\u30fc\u30b8\u3092\u53d7\u4fe1\u3057\u307e\u3057\u305f (type6)",this._on_error(d));else d={name:"invalid_message",errno:24001},d.message=this._name+"\u304b\u3089\u4e0d\u6b63\u306a\u30e1\u30c3\u30bb\u30fc\u30b8\u3092\u53d7\u4fe1\u3057\u307e\u3057\u305f (type1)",
this._on_error(d);else{var d={name:"invalid_message",errno:24E3};d.message=this._name+"\u304b\u3089\u4e0d\u6b63\u306a\u30e1\u30c3\u30bb\u30fc\u30b8\u3092\u53d7\u4fe1\u3057\u307e\u3057\u305f (type0)";this._on_error(d)}};
SpeechRec.WebSocket.prototype.set_one_time_callback=function(a,c,b,d){this._ws instanceof WebSocket?SpeechRec._fn.is_string(a)?c instanceof Function?(this._ws._one_time_callback[a]=c,b||SpeechRec._state_changed(),void 0===d&&(d=3E4),"(IN ERROR)"!==SpeechRec._state&&"pcm"!==a&&(SpeechRec._timer[a]=setTimeout(function(){for(var b in SpeechRec._timer)clearTimeout(SpeechRec._timer[b]),delete SpeechRec._timer[b];SpeechRec._timer={};b={name:"runtime_error",errno:21001};b.message="timeout for "+a;SpeechRec._cb.all("error",
b)},d))):(c={name:"fatal_error",errno:20014},c.message=this._name+"\u3078\u306e\u30b3\u30fc\u30eb\u30d0\u30c3\u30af\u306e\u8ffd\u52a0\u306b\u5931\u6557\u3057\u307e\u3057\u305f (callback\u306b\u306f\u95a2\u6570\u3092\u6307\u5b9a\u3057\u3066\u4e0b\u3055\u3044)",this._on_error(c)):(c={name:"fatal_error",errno:20013},c.message=this._name+"\u3078\u306e\u30b3\u30fc\u30eb\u30d0\u30c3\u30af\u306e\u8ffd\u52a0\u306b\u5931\u6557\u3057\u307e\u3057\u305f (name\u306b\u306f\u6587\u5b57\u5217\u3092\u6307\u5b9a\u3057\u3066\u4e0b\u3055\u3044)",
this._on_error(c)):c instanceof Function&&(c(),b||SpeechRec._state_changed())};
SpeechRec.WebSocket.prototype.del_one_time_callback=function(a,c){if(this._ws instanceof WebSocket)if(SpeechRec._fn.is_string(a))a in this._ws._one_time_callback&&(delete this._ws._one_time_callback[a],void 0!==SpeechRec._timer[a]&&(clearTimeout(SpeechRec._timer[a]),delete SpeechRec._timer[a])),c||SpeechRec._state_changed();else{var b={name:"fatal_error",errno:20015};b.message=this._name+"\u304b\u3089\u306e\u30b3\u30fc\u30eb\u30d0\u30c3\u30af\u306e\u524a\u9664\u306b\u5931\u6557\u3057\u307e\u3057\u305f (name\u306b\u306f\u6587\u5b57\u5217\u3092\u6307\u5b9a\u3057\u3066\u4e0b\u3055\u3044)";this._on_error(b)}};
SpeechRec.WebSocket.prototype.del_one_time_callback_all=function(a){if(this._ws instanceof WebSocket){for(var c in this._ws._one_time_callback)delete this._ws._one_time_callback[c],void 0!==SpeechRec._timer[c]&&(clearTimeout(SpeechRec._timer[c]),delete SpeechRec._timer[c]);this._ws._one_time_callback={};a||SpeechRec._state_changed()}};SpeechRec.WebSocket.prototype.configure=function(a,c){this._ws instanceof WebSocket&&(this.set_one_time_callback("configured",c),this._send({key:"configure",value:JSON.stringify(a)}))};
SpeechRec._rex=new SpeechRec.WebSocket("\u97f3\u58f0\u8a8d\u8b58\u30b5\u30fc\u30d0");SpeechRec._rex._opus_encoder=void 0;SpeechRec._rex._num_of_samples_per_encode=void 0;SpeechRec._rex._pre_samples=void 0;SpeechRec._rex.recognizer_open=function(a){this.set_one_time_callback("recognizer_opened",a);this._send({key:"recognizer_open",value:null})};SpeechRec._rex.recognizer_close=function(a){this.set_one_time_callback("recognizer_closed",a);this._send({key:"recognizer_close",value:null})};
SpeechRec._rex.recognition_start=function(a){this.del_one_time_callback_all(!0);this.set_one_time_callback("recognition_started",a);this._send({key:"recognition_start",value:null})};SpeechRec._rex.recognition_stop=function(a){this.del_one_time_callback_all(!0);this.set_one_time_callback("recognition_stopped",a);this._send({key:"recognition_stop",value:null})};SpeechRec._rex._on_opus=function(a){"START"===SpeechRec._state&&this._ws instanceof WebSocket&&this._ws&&1==this._ws.readyState&&this._ws.send(a)};
SpeechRec._rex.on_pcm=function(a){if("START"===SpeechRec._state&&(void 0===this._opus_encoder&&(this._opus_encoder=new Worker(SpeechRec._config.OpusWorkerUrl),this._opus_encoder.onerror=function(a){SpeechRec._rex._on_error({name:"runtime_error",errno:21002,message:"Opus\u30a8\u30f3\u30b3\u30fc\u30c0\u306e\u69cb\u7bc9\u306b\u5931\u6557\u3057\u307e\u3057\u305f"})},this._opus_encoder.onmessage=function(a){if("START"===SpeechRec._state)if(!a)console.warn("OpusEncoder.onmessage ignored (! event)");else if(!a.data)console.warn("OpusEncoder.onmessage ignored (! event.data)");
else if("string"===typeof a.data)console.warn('OpusEncoder.onmessage ignored ("'+a.data+'")');else if(a.data instanceof ArrayBuffer){var b=new Int8Array(a.data);if(0>=b.length)console.warn("OpusEncoder.onmessage ignored (event.data.length <= 0)");else{a=Object.prototype.toString.call(b).slice(8,-1);if(-1!=a.search(/32/))a=4;else if(-1!=a.search(/16/))a=2;else if(-1!=a.search(/8/))a=1;else{console.warn("OpusEncoder.onmessage ignored ("+a+")");return}var c=b.length*a,d=new Uint8Array(13+c),e=new DataView(d.buffer);
e.setUint8(0,79);e.setUint8(1,80);e.setUint8(2,85);e.setUint8(3,83);e.setUint8(4,58);e.setInt32(5,c,!1);for(var b=new DataView(b.buffer),f=0;f<c;)1==a?(e.setInt8(13+f,b.getInt8(f)),f+=a):2==a?(e.setInt16(13+f,b.getInt16(f,!0),!1),f+=a):4==a&&(e.setInt32(13+f,b.getInt32(f,!0),!1),f+=a);SpeechRec._rex._on_opus(d)}}},void 0===this._num_of_samples_per_encode&&(this._num_of_samples_per_encode=Math.floor(320))),!(0>=a.length))){this._opus_encoder.postMessage({samplingrate:16E3,channels:1,framesize:this._num_of_samples_per_encode,
application:"audio",type:"encoder",band:"WB",lsb_depth:16,bitrate:27E3,vbr:1});var c;void 0===this._carried_over_samples?(c=new Int16Array(a.length),c.set(a)):(c=new Int16Array(this._carried_over_samples.length+a.length),c.set(this._carried_over_samples),c.set(a,this._carried_over_samples.length));a=new ArrayBuffer(2*this._num_of_samples_per_encode);for(a=new Int16Array(a);c.length>this._num_of_samples_per_encode;){for(var b=0,d=0;d<this._num_of_samples_per_encode;d++){a[d]=c[d];var e=a[d];0==e&&
(e=1);r=Math.pow(e,2)/Math.pow(32767,2);e=Math.log(r)/Math.log(10)*10;b+=e}b/=this._num_of_samples_per_encode;SpeechRec._cb.all("proc",{volume:b});!1===SpeechRec.is_mute&&this._opus_encoder.postMessage(a.buffer);c=c.subarray(this._num_of_samples_per_encode)}this._carried_over_samples=c}};
SpeechRec.is_chrome()?SpeechRec._cwa=new SpeechRec.WebAudio:(SpeechRec._mic=new SpeechRec.WebSocket("\u30de\u30a4\u30af\u97f3\u58f0\u53d6\u5f97\u9001\u4fe1\u30e2\u30b8\u30e5\u30fc\u30eb"),SpeechRec._mic.is_recording=!1,SpeechRec._mic.is_buffering=!1,SpeechRec._mic.ask=function(a,c){this.is_buffering=this.is_recording=!1;if(jQuery("#SpeechRec_ie_ask_mask")[0])if(!0===SpeechRec._mic._allowed_flag)if(a instanceof Function)a();else{var b={name:"fatal_error",errno:20016};b.message=this._name+": ask\u306e\u5b9f\u884c\u306b\u5931\u6557\u3057\u307e\u3057\u305f (allowed\u306b\u306f\u95a2\u6570\u3092\u6307\u5b9a\u3057\u3066\u4e0b\u3055\u3044)";
throw b;}else if(c instanceof Function)c();else throw b={name:"fatal_error",errno:20017},b.message=this._name+": ask\u306e\u5b9f\u884c\u306b\u5931\u6557\u3057\u307e\u3057\u305f (denied\u306b\u306f\u95a2\u6570\u3092\u6307\u5b9a\u3057\u3066\u4e0b\u3055\u3044)",b;else{var d=document.createElement("span");d.innerHTML=location.href+" wants to use your microphone. ";var e=document.createElement("button");e.id="SpeechRec_ie_ask_allow_button";e.innerHTML="Allow";var g=document.createElement("button");g.id=
"SpeechRec_ie_ask_deny_button";g.innerHTML="Deny";b=document.createElement("div");b.id="SpeechRec_ie_ask_button_bar";b.appendChild(d);b.appendChild(e);b.appendChild(g);d=document.createElement("div");d.id="SpeechRec_ie_ask_mask";d.appendChild(b);jQuery("body")[0].appendChild(d);jQuery("#SpeechRec_ie_ask_button_bar").css("margin",0).css("padding","0.5em").css("background-color","#bbbbbb").css("opacity",1).css("border","solid 1px #aaaaaa");jQuery("#SpeechRec_ie_ask_mask").css("z-index",99).css("position",
"absolute").css("top",0).css("left",0).css("margin",0).css("padding",0).css("background-color","#eeeeee").css("opacity",.8).css("width",document.documentElement.clientWidth).css("height",document.documentElement.clientHeight);jQuery("#SpeechRec_ie_ask_allow_button").attr("class","SpeechRec_ie_ask_buttons").click(function(){jQuery("#SpeechRec_ie_ask_mask").hide();SpeechRec._mic._allowed_flag=!0;if(a instanceof Function)a();else{var b={name:"fatal_error",errno:20018};b.message=this._name+": ask\u306e\u5b9f\u884c\u306b\u5931\u6557\u3057\u307e\u3057\u305f (allowed\u306b\u306f\u95a2\u6570\u3092\u6307\u5b9a\u3057\u3066\u4e0b\u3055\u3044)";
throw b;}});jQuery("#SpeechRec_ie_ask_deny_button").attr("class","SpeechRec_ie_ask_buttons").click(function(){jQuery("#SpeechRec_ie_ask_mask").hide();SpeechRec._mic._allowed_flag=!1;if(c instanceof Function)c();else{var a={name:"fatal_error",errno:20019};a.message=this._name+": ask\u306e\u5b9f\u884c\u306b\u5931\u6557\u3057\u307e\u3057\u305f (denied\u306b\u306f\u95a2\u6570\u3092\u6307\u5b9a\u3057\u3066\u4e0b\u3055\u3044)";throw a;}});jQuery(".SpeechRec_ie_ask_buttons").each(function(){jQuery(this).css("margin",
"0 0.3em").css("padding","0.5em 0.4em")});jQuery(window).resize(function(){jQuery("#SpeechRec_ie_ask_mask").css("width",document.documentElement.clientWidth).css("height",document.documentElement.clientHeight)})}},SpeechRec._mic.recording_start=function(a){this.is_recording?a instanceof Function&&a():(this.set_one_time_callback("recording_started",a),this._send({key:"recording_start",value:null}),this.is_recording=!0)},SpeechRec._mic.recording_stop=function(a){this.is_recording?(this.is_recording=
!1,this.set_one_time_callback("recording_stopped",a),this._send({key:"recording_stop",value:null})):a instanceof Function&&a()},SpeechRec._mic.buffering_start=function(a){this.is_buffering?a instanceof Function&&a():(this.set_one_time_callback("buffering_started",a),this._send({key:"buffering_start",value:null}),this.is_buffering=!0)},SpeechRec._mic.buffering_stop=function(a){this.is_buffering?(this.is_buffering=!1,this.set_one_time_callback("buffering_stopped",a),this._send({key:"buffering_stop",
value:null})):a instanceof Function&&a()},SpeechRec._mic.on_pcm=function(a){if("START"===SpeechRec._state)if(a.length%2){var c={name:"invalid_message",errno:24007};c.message=this._name+"\u304b\u3089\u4e0d\u6b63\u306a\u30e1\u30c3\u30bb\u30fc\u30b8\u3092\u53d7\u4fe1\u3057\u307e\u3057\u305f (type7): "+a.length;SpeechRec._mic._on_error(c)}else{if(0<a.length){c=new DataView(a.buffer);a=new Int16Array((a.length-4)/Int16Array.BYTES_PER_ELEMENT);for(var b=0;b<a.length;b++)a[b]=c.getInt16(b*Int16Array.BYTES_PER_ELEMENT+
4,!1);SpeechRec._rex.on_pcm(a)}SpeechRec._mic.set_one_time_callback("pcm",SpeechRec._mic.on_pcm,!0);SpeechRec._mic._send({key:"transfer",value:null})}},SpeechRec._mic.transfer=function(a){this.set_one_time_callback("pcm",SpeechRec._mic.on_pcm);this._send({key:"transfer",value:null});a instanceof Function&&a()});
SpeechRec._state_changed=function(a){var c=[];c.push(SpeechRec._state);SpeechRec.is_chrome()?c.push(SpeechRec._cwa.state()):c.push(SpeechRec._mic.state());c.push(SpeechRec._rex.state());var b=JSON.stringify(c),d=JSON.stringify(SpeechRec._state_obj);b!==d?SpeechRec._cb.all("state_changed",c):a&&SpeechRec._cb.all("state_changed",c);SpeechRec._state_obj_prev=SpeechRec._state_obj;return SpeechRec._state_obj=c};
SpeechRec._error_in_client=function(a){if("(IN ERROR)"!==SpeechRec._state){SpeechRec._set_state("(IN ERROR)");if(!("name"in a)){var c={name:"fatal_error",errno:20020,message:"_error_in_client(error) called, but (! ('name' in error))"};throw c;}if(!("message"in a))throw c={name:"fatal_error",errno:20021,message:"_error_in_client(error) called, but (! ('message' in error))"},c;SpeechRec._rex.del_one_time_callback_all();SpeechRec._rex.recognition_stop(function(){SpeechRec._rex.recognizer_close(function(){SpeechRec._rex.close(function(){if(SpeechRec.is_chrome()){SpeechRec._set_state("STOP");
SpeechRec._cb.all("error",a);for(var b in SpeechRec._timer)clearTimeout(SpeechRec._timer[b]),delete SpeechRec._timer[b];SpeechRec._timer={}}else SpeechRec._mic.del_one_time_callback_all(),SpeechRec._mic.buffering_stop(function(){SpeechRec._mic.recording_stop(function(){SpeechRec._mic.close(function(){SpeechRec._set_state("STOP");SpeechRec._cb.all("error",a);for(var b in SpeechRec._timer)clearTimeout(SpeechRec._timer[b]),delete SpeechRec._timer[b];SpeechRec._timer={}})})})})})})}};
SpeechRec._error_in_rex=function(a){if("(IN ERROR)"!==SpeechRec._state){SpeechRec._set_state("(IN ERROR)");if(!("name"in a)){var c={name:"fatal_error",errno:20022,message:"_error_in_rex(error) called, but (! ('name' in error))"};throw c;}if(!("message"in a))throw c={name:"fatal_error",errno:20023,message:"_error_in_rex(error) called, but (! ('message' in error))"},c;SpeechRec._rex.del_one_time_callback_all();SpeechRec._rex.close(function(){SpeechRec.is_chrome()?SpeechRec._cwa.close(function(){SpeechRec._set_state("STOP");
SpeechRec._cb.all("error",a);for(var b in SpeechRec._timer)clearTimeout(SpeechRec._timer[b]),delete SpeechRec._timer[b];SpeechRec._timer={}}):(SpeechRec._mic.del_one_time_callback_all(),SpeechRec._mic.buffering_stop(function(){SpeechRec._mic.recording_stop(function(){SpeechRec._mic.close(function(){SpeechRec._set_state("STOP");SpeechRec._cb.all("error",a);for(var b in SpeechRec._timer)clearTimeout(SpeechRec._timer[b]),delete SpeechRec._timer[b];SpeechRec._timer={}})})}))})}};
SpeechRec._error_in_mic=function(a){if("(IN ERROR)"!==SpeechRec._state){SpeechRec._set_state("(IN ERROR)");if(!("name"in a)){var c={name:"fatal_error",errno:20024,message:"_error_in_mic(error) called, but (! ('name' in error))"};throw c;}if(!("message"in a))throw c={name:"fatal_error",errno:20025,message:"_error_in_mic(error) called, but (! ('message' in error))"},c;SpeechRec._rex.del_one_time_callback_all();SpeechRec.is_chrome()?SpeechRec._cwa.close(function(){SpeechRec._set_state("STOP");SpeechRec._cb.all("error",
a);for(var b in SpeechRec._timer)clearTimeout(SpeechRec._timer[b]),delete SpeechRec._timer[b];SpeechRec._timer={}}):(SpeechRec._mic.del_one_time_callback_all(),SpeechRec._mic.close(function(){SpeechRec._rex.recognition_stop(function(){SpeechRec._rex.recognizer_close(function(){SpeechRec._rex.close(function(){SpeechRec._set_state("STOP");SpeechRec._cb.all("error",a);for(var b in SpeechRec._timer)clearTimeout(SpeechRec._timer[b]),delete SpeechRec._timer[b];SpeechRec._timer={}})})})}))}};
SpeechRec._on_voiceless=function(){SpeechRec._rex.del_one_time_callback("voice_begin");SpeechRec._config.ContinuousMode?SpeechRec._cb.all("voiceless"):(SpeechRec._set_state("(CHANGING)"),SpeechRec._rex.recognition_stop(function(){SpeechRec._rex.recognizer_close(function(){SpeechRec._rex.close(function(){SpeechRec.is_chrome()?SpeechRec._cwa.close(function(){SpeechRec._set_state("STOP");SpeechRec._cb.all("voiceless")}):SpeechRec._mic.buffering_stop(function(){SpeechRec._mic.recording_stop(function(){SpeechRec._mic.close(function(){SpeechRec._set_state("STOP");
SpeechRec._cb.all("voiceless")})})})})})}))};SpeechRec._on_voice_begin=function(){SpeechRec._rex.del_one_time_callback("voiceless");SpeechRec._rex.set_one_time_callback("voice_too_long",SpeechRec._on_voice_too_long,!0);SpeechRec._rex.set_one_time_callback("voice_end",SpeechRec._on_voice_end);SpeechRec._cb.all("voice_begin")};
SpeechRec._on_voice_too_long=function(){SpeechRec._rex.del_one_time_callback("voice_end");SpeechRec._config.ContinuousMode?SpeechRec._cb.all("voice_too_long"):(SpeechRec._set_state("(CHANGING)"),SpeechRec._rex.recognition_stop(function(){SpeechRec._rex.recognizer_close(function(){SpeechRec._rex.close(function(){SpeechRec.is_chrome()?SpeechRec._cwa.close(function(){SpeechRec._set_state("STOP");SpeechRec._cb.all("voice_too_long")}):SpeechRec._mic.buffering_stop(function(){SpeechRec._mic.recording_stop(function(){SpeechRec._mic.close(function(){SpeechRec._set_state("STOP");
SpeechRec._cb.all("voice_too_long")})})})})})}))};SpeechRec._on_voice_end=function(){SpeechRec._rex.del_one_time_callback("voice_too_long");SpeechRec._rex.set_one_time_callback("no_result",SpeechRec._on_no_result,!0);SpeechRec._rex.set_one_time_callback("result",SpeechRec._on_result);SpeechRec._config.ContinuousMode?SpeechRec._cb.all("voice_end"):SpeechRec.is_chrome()?SpeechRec._cwa.close(function(){SpeechRec._cb.all("voice_end")}):SpeechRec._mic.buffering_stop(function(){SpeechRec._mic.recording_stop(function(){SpeechRec._mic.close(function(){SpeechRec._cb.all("voice_end")})})})};
SpeechRec._on_no_result=function(){SpeechRec._rex.del_one_time_callback("result");SpeechRec._config.ContinuousMode?SpeechRec._cb.all("no_result"):(SpeechRec._set_state("(CHANGING)"),SpeechRec._rex.recognition_stop(function(){SpeechRec._rex.recognizer_close(function(){SpeechRec._rex.close(function(){SpeechRec._set_state("STOP");SpeechRec._cb.all("no_result")})})}))};
SpeechRec._on_result=function(a){SpeechRec._rex.del_one_time_callback("no_result");for(var c={candidates:[]},b=0;b<a.candidates.length;b++)0<a.candidates[b].speech.length&&c.candidates.push(a.candidates[b]);SpeechRec._config.ContinuousMode?(SpeechRec._rex.set_one_time_callback("voiceless",SpeechRec._on_voiceless,!0),SpeechRec._rex.set_one_time_callback("voice_begin",SpeechRec._on_voice_begin),0<c.candidates.length?SpeechRec._cb.all("result",c):SpeechRec._on_no_result()):(SpeechRec._set_state("(CHANGING)"),
SpeechRec._rex.recognition_stop(function(){SpeechRec._rex.recognizer_close(function(){SpeechRec._rex.close(function(){SpeechRec._set_state("STOP");0<c.candidates.length?SpeechRec._cb.all("result",c):SpeechRec._on_no_result()})})}))};
SpeechRec._set_state=function(a){if(!(a in SpeechRec.CLIENT_STATE)){var c={name:"fatal_error",errno:20026};c.message="_set_state NG (! (new_state in SpeechRec.CLIENT_STATE)): "+a;throw c;}if("(IN ERROR)"===this._state&&"STOP"!==a)throw c={name:"fatal_error",errno:20027},c.message='_set_state NG (his._state === "(IN ERROR)" && new_state !== "STOP"): '+a,c;this._state=a;SpeechRec._state_changed()};
SpeechRec._validate_config=function(a,c){if(!SpeechRec._fn.is_simple_hash(a)){var b={name:"invalid_config_value",errno:22E3};b.message="\u8a2d\u5b9a\u306b\u5931\u6557\u3057\u307e\u3057\u305f (config\u306b\u306f\u30b7\u30f3\u30d7\u30eb\u306a\u30cf\u30c3\u30b7\u30e5\u3092\u6307\u5b9a\u3057\u3066\u4e0b\u3055\u3044): "+JSON.stringify(a);throw b;}if(1==c)for(var d in SpeechRec.DEFAULT_CONFIG)if(!(d in a))throw b={name:"fatal_error",errno:2E4},b.message="\u8a2d\u5b9a\u306b\u5931\u6557\u3057\u307e\u3057\u305f (\u5fc5\u8981\u306a\u9805\u76ee\u304c\u6307\u5b9a\u3055\u308c\u3066\u3044\u307e\u305b\u3093): config."+
d,b;for(var e in a)if(!(e in SpeechRec.DEFAULT_CONFIG))throw b={name:"invalid_config_value",errno:22001},b.message="\u8a2d\u5b9a\u306b\u5931\u6557\u3057\u307e\u3057\u305f (\u4e0d\u6b63\u306a\u30e1\u30f3\u30d0\u304c\u6307\u5b9a\u3055\u308c\u307e\u3057\u305f): config."+e,b;if("ApiKey"in a){if(!SpeechRec._fn.is_string(a.ApiKey))throw b={name:"invalid_config_value",errno:22010},b.message="\u8a2d\u5b9a\u306b\u5931\u6557\u3057\u307e\u3057\u305f (config.ApiKey\u306b\u306f\u6587\u5b57\u5217\u3092\u6307\u5b9a\u3057\u3066\u4e0b\u3055\u3044): "+
JSON.stringify(a.ApiKey),b;if(2048<a.ApiKey.length)throw b={name:"invalid_config_value",errno:22011,message:"\u8a2d\u5b9a\u306b\u5931\u6557\u3057\u307e\u3057\u305f (config.ApiKey\u306e\u9577\u3055\u304c\u4e0d\u9069\u5207\u3067\u3059 (>2048))"},b;}if("NrFlag"in a&&!SpeechRec._fn.is_boolean(a.NrFlag))throw b={name:"invalid_config_value",errno:22020},b.message="\u8a2d\u5b9a\u306b\u5931\u6557\u3057\u307e\u3057\u305f (config.NrFlag\u306b\u306f\u771f\u507d\u5024\u3092\u6307\u5b9a\u3057\u3066\u4e0b\u3055\u3044): "+
JSON.stringify(a.NrFlag),b;if("SbmMode"in a)switch(a.SbmMode){case 0:case 1:case 2:case 3:break;default:throw b={name:"invalid_config_value",errno:22030},b.message="\u8a2d\u5b9a\u306b\u5931\u6557\u3057\u307e\u3057\u305f (config.SbmMode\u306b\u306f0\uff5e3\u306e\u6574\u6570\u3092\u6307\u5b9a\u3057\u3066\u4e0b\u3055\u3044): "+JSON.stringify(a.SbmMode),b;}if("Recg:Nbest"in a){if(!SpeechRec._fn.is_number(a["Recg:Nbest"]))throw b={name:"invalid_config_value",errno:22040},b.message='\u8a2d\u5b9a\u306b\u5931\u6557\u3057\u307e\u3057\u305f (config["Recg:Nbest"]\u306b\u306f0\uff5e10\u306e\u6574\u6570\u3092\u6307\u5b9a\u3057\u3066\u4e0b\u3055\u3044): '+
JSON.stringify(a["Recg:Nbest"]),b;b=Math.round(a["Recg:Nbest"]);if(a["Recg:Nbest"]!=b)throw b={name:"invalid_config_value",errno:22041},b.message='\u8a2d\u5b9a\u306b\u5931\u6557\u3057\u307e\u3057\u305f (config["Recg:Nbest"]\u306b\u306f0\uff5e10\u306e\u6574\u6570\u3092\u6307\u5b9a\u3057\u3066\u4e0b\u3055\u3044): '+JSON.stringify(a["Recg:Nbest"]),b;if(0>a["Recg:Nbest"]&&10<a["Recg:Nbest"])throw b={name:"invalid_config_value",errno:22042},b.message='\u8a2d\u5b9a\u306b\u5931\u6557\u3057\u307e\u3057\u305f (config["Recg:Nbest"]\u306b\u306f0\uff5e10\u306e\u6574\u6570\u3092\u6307\u5b9a\u3057\u3066\u4e0b\u3055\u3044): '+
JSON.stringify(a["Recg:Nbest"]),b;}if("mic_recorder_port"in a){if(!SpeechRec._fn.is_number(a.mic_recorder_port))throw b={name:"invalid_config_value",errno:22050},b.message="\u8a2d\u5b9a\u306b\u5931\u6557\u3057\u307e\u3057\u305f (config.mic_recorder_port\u306b\u306f1\uff5e60\u306e\u6570\u5024\u3092\u6307\u5b9a\u3057\u3066\u4e0b\u3055\u3044): "+JSON.stringify(a.mic_recorder_port),b;b=Math.round(a.mic_recorder_port);if(a.mic_recorder_port!=b)throw b={name:"invalid_config_value",errno:22051},b.message=
"\u8a2d\u5b9a\u306b\u5931\u6557\u3057\u307e\u3057\u305f (config.mic_recorder_port\u306b\u306f0\uff5e65535\u306e\u6574\u6570\u3092\u6307\u5b9a\u3057\u3066\u4e0b\u3055\u3044): "+JSON.stringify(a.mic_recorder_port),b;if(!SpeechRec._fn.is_number(a.mic_recorder_port)||0>a.mic_recorder_port||65535<a.mic_recorder_port)throw b={name:"invalid_config_value",errno:22052},b.message="\u8a2d\u5b9a\u306b\u5931\u6557\u3057\u307e\u3057\u305f (config.mic_recorder_port\u306b\u306f0\uff5e65535\u306e\u6574\u6570\u3092\u6307\u5b9a\u3057\u3066\u4e0b\u3055\u3044): "+
JSON.stringify(a.mic_recorder_port),b;}if("buffer_size_as_seconds"in a){if(!SpeechRec._fn.is_number(a.buffer_size_as_seconds))throw b={name:"invalid_config_value",errno:22060},b.message="\u8a2d\u5b9a\u306b\u5931\u6557\u3057\u307e\u3057\u305f (config.buffer_size_as_seconds\u306b\u306f1\uff5e60\u306e\u6570\u5024\u3092\u6307\u5b9a\u3057\u3066\u4e0b\u3055\u3044): "+JSON.stringify(a.buffer_size_as_seconds),b;if(1>a.buffer_size_as_seconds)throw b={name:"invalid_config_value",errno:22061},b.message="\u8a2d\u5b9a\u306b\u5931\u6557\u3057\u307e\u3057\u305f (config.buffer_size_as_seconds\u306b\u306f1\uff5e60\u306e\u6570\u5024\u3092\u6307\u5b9a\u3057\u3066\u4e0b\u3055\u3044): "+
JSON.stringify(a.buffer_size_as_seconds),b;if(60<a.buffer_size_as_seconds)throw b={name:"invalid_config_value",errno:22062},b.message="\u8a2d\u5b9a\u306b\u5931\u6557\u3057\u307e\u3057\u305f (config.buffer_size_as_seconds\u306b\u306f1\uff5e60\u306e\u6570\u5024\u3092\u6307\u5b9a\u3057\u3066\u4e0b\u3055\u3044): "+JSON.stringify(a.buffer_size_as_seconds),b;}if("SRL:UserDefine"in a){if(!SpeechRec._fn.is_string(a["SRL:UserDefine"]))throw b={name:"invalid_config_value",errno:22070},b.message='\u8a2d\u5b9a\u306b\u5931\u6557\u3057\u307e\u3057\u305f (config["SRL:UserDefine"]\u306b\u306f\u6587\u5b57\u5217\u3092\u6307\u5b9a\u3057\u3066\u4e0b\u3055\u3044(\u9577\u3055255\u307e\u3067)): '+
JSON.stringify(a["SRL:UserDefine"]),b;if(255<a["SRL:UserDefine"].length)throw b={name:"invalid_config_value",errno:22071},b.message='\u8a2d\u5b9a\u306b\u5931\u6557\u3057\u307e\u3057\u305f (config["SRL:UserDefine"]\u306b\u306f\u6587\u5b57\u5217\u3092\u6307\u5b9a\u3057\u3066\u4e0b\u3055\u3044(\u9577\u3055255\u307e\u3067)): '+JSON.stringify(a["SRL:UserDefine"]),b;if(a["SRL:UserDefine"].match(/^FILENAME-.*$/))throw b={name:"invalid_config_value",errno:22072},b.message='\u8a2d\u5b9a\u306b\u5931\u6557\u3057\u307e\u3057\u305f (config["SRL:UserDefine"]\u306b\u4e0d\u9069\u5207\u306a\u5024\u304c\u8a2d\u5b9a\u3055\u308c\u3066\u3044\u307e\u3059): '+
JSON.stringify(a["SRL:UserDefine"]),b;if(a["SRL:UserDefine"].match(/^METAINFO=.*$/))throw b={name:"invalid_config_value",errno:22073},b.message='\u8a2d\u5b9a\u306b\u5931\u6557\u3057\u307e\u3057\u305f (config["SRL:UserDefine"]\u306b\u4e0d\u9069\u5207\u306a\u5024\u304c\u8a2d\u5b9a\u3055\u308c\u3066\u3044\u307e\u3059): '+JSON.stringify(a["SRL:UserDefine"]),b;if(!a["SRL:UserDefine"].match(/^[a-zA-Z0-9!#$%=@.-]*$/))throw b={name:"invalid_config_value",errno:22074},b.message='\u8a2d\u5b9a\u306b\u5931\u6557\u3057\u307e\u3057\u305f (config["SRL:UserDefine"]\u306b\u306f\u534a\u89d2\u82f1\u6570\u53ca\u3073\u6b21\u306e8\u7a2e\u306e\u534a\u89d2\u8a18\u53f7 !#$%=-@. \u4ee5\u5916\u306f\u4f7f\u7528\u3067\u304d\u307e\u305b\u3093): '+
JSON.stringify(a["SRL:UserDefine"]),b;}if("ContinuousMode"in a&&!SpeechRec._fn.is_boolean(a.ContinuousMode))throw b={name:"invalid_config_value",errno:22080},b.message="\u8a2d\u5b9a\u306b\u5931\u6557\u3057\u307e\u3057\u305f (config.ContinuousMode\u306b\u306f\u771f\u507d\u5024\u3092\u6307\u5b9a\u3057\u3066\u4e0b\u3055\u3044): "+JSON.stringify(a.ContinuousMode),b;if("OpusWorkerUrl"in a){if(!SpeechRec._fn.is_string(a.OpusWorkerUrl))throw b={name:"invalid_config_value",errno:22090},b.message="\u8a2d\u5b9a\u306b\u5931\u6557\u3057\u307e\u3057\u305f (config.OpusWorkerUrl\u306b\u306f\u6587\u5b57\u5217\u3092\u6307\u5b9a\u3057\u3066\u4e0b\u3055\u3044(\u9577\u30551\u4ee5\u4e0a)): "+
JSON.stringify(a.OpusWorkerUrl),b;if(0>=a.OpusWorkerUrl.length)throw b={name:"invalid_config_value",errno:22091},b.message="\u8a2d\u5b9a\u306b\u5931\u6557\u3057\u307e\u3057\u305f (config.OpusWorkerUrl\u306b\u306f\u6587\u5b57\u5217\u3092\u6307\u5b9a\u3057\u3066\u4e0b\u3055\u3044(\u9577\u30551\u4ee5\u4e0a)): "+JSON.stringify(a.OpusWorkerUrl),b;}if("TooLongAbort"in a&&!SpeechRec._fn.is_boolean(a.TooLongAbort))throw b={name:"invalid_config_value",errno:22100},b.message="\u8a2d\u5b9a\u306b\u5931\u6557\u3057\u307e\u3057\u305f (config.TooLongAbort\u306b\u306f\u771f\u507d\u5024\u3092\u6307\u5b9a\u3057\u3066\u4e0b\u3055\u3044): "+
JSON.stringify(a.TooLongAbort),b;if("SkyWayKey"in a){if(!SpeechRec._fn.is_string(a.SkyWayKey))throw b={name:"invalid_config_value",errno:22090},b.message="\u8a2d\u5b9a\u306b\u5931\u6557\u3057\u307e\u3057\u305f (config.OpusWorkerUrl\u306b\u306f\u6587\u5b57\u5217\u3092\u6307\u5b9a\u3057\u3066\u4e0b\u3055\u3044(\u9577\u30551\u4ee5\u4e0a)): "+JSON.stringify(a.SkyWayKey),b;if(0>=a.SkyWayKey.length)throw b={name:"invalid_config_value",errno:22091},b.message="\u8a2d\u5b9a\u306b\u5931\u6557\u3057\u307e\u3057\u305f (config.OpusWorkerUrl\u306b\u306f\u6587\u5b57\u5217\u3092\u6307\u5b9a\u3057\u3066\u4e0b\u3055\u3044(\u9577\u30551\u4ee5\u4e0a)): "+
JSON.stringify(a.SkyWayKey),b;}};
SpeechRec.start=function(){try{if("DENY"===this._state)throw{name:"runtime_error",errno:21003,message:"\u30de\u30a4\u30af\u304b\u3089\u306e\u97f3\u58f0\u53d6\u5f97\u304c\u62d2\u5426\u3055\u308c\u3066\u3044\u307e\u3059"};if("STOP"!==this._state)console.warn("SpeechRec.start()\u304c\u5b9f\u884c\u3055\u308c\u307e\u3057\u305f\u304c\u3001\u505c\u6b62\u4e2d\u72b6\u614b\u3067\u7121\u3044\u305f\u3081\u7121\u8996\u3057\u307e\u3059");else{if(!0!==SpeechRec._is_configured){var a={},c;for(c in SpeechRec._config)a[c]=
SpeechRec._config[c];SpeechRec.config(a)}SpeechRec._set_state("ASKING");SpeechRec._cb.all("ask");SpeechRec.is_chrome()?SpeechRec._cwa.ask(function(){SpeechRec._cb.all("allow");SpeechRec._set_state("ALLOW");SpeechRec._set_state("(CHANGING)");$.get(SpeechRec.SKYWAY_URL+SpeechRec._config.SkyWayKey,function(a){console.log(a);SpeechRec._rex._url=SpeechRec.BASE_URL+"?key="+SpeechRec._config.SkyWayKey+"&token="+a;SpeechRec._rex.open(function(){var a={ClientVersion:SpeechRec._client_version,UserAgent:SpeechRec.USER_AGENT,
ApiKey:SpeechRec._config.ApiKey,NrFlag:SpeechRec._config.NrFlag,SbmMode:SpeechRec._config.SbmMode,TooLongAbort:SpeechRec._config.TooLongAbort,ContinuousMode:SpeechRec._config.ContinuousMode};""!==SpeechRec._config["SRL:UserDefine"]&&(a["SRL:UserDefine"]=SpeechRec._config["SRL:UserDefine"]);0!==SpeechRec._config["Recg:Nbest"]&&(a["Recg:Nbest"]=SpeechRec._config["Recg:Nbest"]);SpeechRec._rex.configure(a,function(){SpeechRec._rex.recognizer_open(function(){SpeechRec._rex.recognition_start(function(){SpeechRec._rex.set_one_time_callback("voiceless",
SpeechRec._on_voiceless,!0);SpeechRec._rex.set_one_time_callback("voice_begin",SpeechRec._on_voice_begin);SpeechRec._cwa.open(function(){SpeechRec._set_state("START");SpeechRec._cb.all("start")},SpeechRec._on_audio)})})})})})},function(){SpeechRec._cb.all("deny");SpeechRec._set_state("DENY")}):SpeechRec._mic.ask(function(){SpeechRec._cb.all("allow");SpeechRec._set_state("ALLOW");SpeechRec._set_state("(CHANGING)");SpeechRec._mic.open(function(){SpeechRec._mic.configure({buffer_size_as_seconds:SpeechRec._config.buffer_size_as_seconds},
function(){SpeechRec._mic.recording_start(function(){SpeechRec._rex.open(function(){var a={ClientVersion:SpeechRec._client_version,UserAgent:SpeechRec.USER_AGENT,ApiKey:SpeechRec._config.ApiKey,NrFlag:SpeechRec._config.NrFlag,SbmMode:SpeechRec._config.SbmMode,TooLongAbort:SpeechRec._config.TooLongAbort,ContinuousMode:SpeechRec._config.ContinuousMode};""!==SpeechRec._config["SRL:UserDefine"]&&(a["SRL:UserDefine"]=SpeechRec._config["SRL:UserDefine"]);0!==SpeechRec._config["Recg:Nbest"]&&(a["Recg:Nbest"]=
SpeechRec._config["Recg:Nbest"]);SpeechRec._rex.configure(a,function(){SpeechRec._rex.recognizer_open(function(){SpeechRec._rex.recognition_start(function(){SpeechRec._rex.set_one_time_callback("voiceless",SpeechRec._on_voiceless,!0);SpeechRec._rex.set_one_time_callback("voice_begin",SpeechRec._on_voice_begin);SpeechRec._mic.buffering_start(function(){SpeechRec._mic.transfer();SpeechRec._set_state("START");SpeechRec._cb.all("start")})})})})})})})})},function(){SpeechRec._cb.all("deny");SpeechRec._set_state("DENY")})}}catch(b){SpeechRec._error_in_client(b)}};
SpeechRec.stop=function(){try{"START"!==this._state?console.warn("SpeechRec.stop()\u304c\u5b9f\u884c\u3055\u308c\u307e\u3057\u305f\u304c\u3001\u8a8d\u8b58\u4e2d\u72b6\u614b\u3067\u7121\u3044\u305f\u3081\u7121\u8996\u3057\u307e\u3059"):(SpeechRec._set_state("(CHANGING)"),SpeechRec.is_chrome()?SpeechRec._cwa.close(function(){SpeechRec._rex.recognition_stop(function(){SpeechRec._rex.recognizer_close(function(){SpeechRec._rex.close(function(){SpeechRec._set_state("STOP");SpeechRec._cb.all("stop")})})})}):
SpeechRec._mic.buffering_stop(function(){SpeechRec._mic.recording_stop(function(){SpeechRec._mic.close(function(){SpeechRec._rex.recognition_stop(function(){SpeechRec._rex.recognizer_close(function(){SpeechRec._rex.close(function(){SpeechRec._set_state("STOP");SpeechRec._cb.all("stop")})})})})})}))}catch(a){SpeechRec._error_in_client(a)}};
SpeechRec.config=function(a){try{if("STOP"!==this._state)console.warn("SpeechRec.config()\u304c\u5b9f\u884c\u3055\u308c\u307e\u3057\u305f\u304c\u3001\u505c\u6b62\u4e2d\u72b6\u614b\u3067\u306a\u3044\u305f\u3081\u7121\u8996\u3057\u307e\u3059");else{SpeechRec._validate_config(a);for(var c in SpeechRec.DEFAULT_CONFIG)SpeechRec._config[c]=SpeechRec.DEFAULT_CONFIG[c];"ApiKey"in a&&(SpeechRec._config.ApiKey=a.ApiKey);"OpusWorkerUrl"in a&&(SpeechRec._config.OpusWorkerUrl=a.OpusWorkerUrl);"NrFlag"in a&&(SpeechRec._config.NrFlag=
a.NrFlag);"SbmMode"in a&&(SpeechRec._config.SbmMode=a.SbmMode);"Recg:Nbest"in a&&(SpeechRec._config["Recg:Nbest"]=a["Recg:Nbest"]);"ContinuousMode"in a&&(SpeechRec._config.ContinuousMode=a.ContinuousMode);"SRL:UserDefine"in a&&(SpeechRec._config["SRL:UserDefine"]=a["SRL:UserDefine"]);"TooLongAbort"in a&&(SpeechRec._config.TooLongAbort=a.TooLongAbort);"SkyWayKey"in a&&(SpeechRec._config.SkyWayKey=a.SkyWayKey);"mic_recorder_port"in a&&(SpeechRec._config.mic_recorder_port=a.mic_recorder_port);SpeechRec._validate_config(SpeechRec._config,
!0);SpeechRec._is_configured||(SpeechRec._rex.initialize({url:SpeechRec.SRP_H5_URL,on_error:SpeechRec._error_in_rex,callbacks:{}}),SpeechRec.is_chrome()?SpeechRec._cwa.initialize({on_pcm:SpeechRec._rex.on_pcm}):SpeechRec._mic.initialize({url:"wss://localhost:"+SpeechRec._config.mic_recorder_port+"/",on_error:SpeechRec._error_in_mic,callbacks:{audio_device_found:function(){SpeechRec._cb.all("mic_enabled")},audio_device_lost:function(){SpeechRec._cb.all("mic_disabled")},audio_pressure_level:function(a){SpeechRec._cb.all("audio_pressure_level",
a)}}}));SpeechRec._is_configured=!0;a={};a=SpeechRec.is_chrome()?{TooLongAbort:SpeechRec._config.TooLongAbort,OpusWorkerUrl:SpeechRec._config.OpusWorkerUrl,"SRL:UserDefine":SpeechRec._config["SRL:UserDefine"],NrFlag:SpeechRec._config.NrFlag,SbmMode:SpeechRec._config.SbmMode,"Recg:Nbest":SpeechRec._config["Recg:Nbest"]}:{TooLongAbort:SpeechRec._config.TooLongAbort,OpusWorkerUrl:SpeechRec._config.OpusWorkerUrl,"SRL:UserDefine":SpeechRec._config["SRL:UserDefine"],NrFlag:SpeechRec._config.NrFlag,SbmMode:SpeechRec._config.SbmMode,
"Recg:Nbest":SpeechRec._config["Recg:Nbest"],mic_recorder_port:SpeechRec._config.mic_recorder_port};SpeechRec._cb.all("config",a)}}catch(b){SpeechRec._error_in_client(b)}};SpeechRec._state="STOP";SpeechRec._config=SpeechRec.DEFAULT_CONFIG;SpeechRec._state_changed();SpeechRec.mute_on=function(){SpeechRec.is_mute=!0};SpeechRec.mute_off=function(){SpeechRec.is_mute=!1};
