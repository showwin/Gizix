var SpeexResampler=function(){function a(d,e,f,c,g,b){"undefined"===typeof b&&(b=5);this.out_len_ptr=this.in_len_ptr=this.in_capacity=this.out_ptr=this.in_ptr=this.handle=0;this.channels=d;this.in_rate=e;this.out_rate=f;this.bits_per_sample=c;var a=c/8;if(0!=c%8||1>a||4<a)throw"argument error: bits_per_sample = "+c;if(g&&32!=c)throw"argument error: if is_float=true, bits_per_sample must be 32";a=allocate(4,"i32",ALLOC_STACK);this.handle=_speex_resampler_init(d,e,f,b,a);if(0!=getValue(a,"i32"))throw"speex_resampler_init failed: ret="+
getValue(a,"i32");g?this.copy_to_buf=this._from_f32:8==c?this.copy_to_buf=this._from_i8:16==c?this.copy_to_buf=this._from_i16:24==c?this.copy_to_buf=this._from_i24:32==c&&(this.copy_to_buf=this._from_i32);this.in_len_ptr=_malloc(4);this.out_len_ptr=_malloc(4)}a.prototype.process=function(d){if(!this.handle)throw"disposed object";var e=d.byteLength/(this.bits_per_sample/8)/this.channels,f=Math.ceil(e*this.out_rate/this.in_rate),c=4*e;this.in_capacity<c&&(this.in_ptr&&_free(this.in_ptr),this.out_ptr&&
_free(this.out_ptr),this.in_ptr=_malloc(c),this.out_ptr=_malloc(4*f),this.in_capacity=c);for(var c=[],a=0;a<this.channels;++a){this.copy_to_buf(d,a,e);setValue(this.in_len_ptr,e,"i32");setValue(this.out_len_ptr,f,"i32");var b=_speex_resampler_process_float(this.handle,a,this.in_ptr,this.in_len_ptr,this.out_ptr,this.out_len_ptr);if(0!=b)throw"speex_resampler_process_float failed: "+b;var b=getValue(this.out_len_ptr,"i32"),h=new Float32Array(b);h.set(HEAPF32.subarray(this.out_ptr>>2,(this.out_ptr>>
2)+b));c.push(h)}return c};a.prototype.process_interleaved=function(d){if(!this.handle)throw"disposed object";var e=d.byteLength/(this.bits_per_sample/8),a=Math.ceil(e*this.out_rate/this.in_rate),c=4*e;this.in_capacity<c&&(this.in_ptr&&_free(this.in_ptr),this.out_ptr&&_free(this.out_ptr),this.in_ptr=_malloc(c),this.out_ptr=_malloc(4*a),this.in_capacity=c);this.copy_to_buf(d,-1,e);setValue(this.in_len_ptr,e/this.channels,"i32");setValue(this.out_len_ptr,a/this.channels,"i32");d=_speex_resampler_process_interleaved_float(this.handle,
this.in_ptr,this.in_len_ptr,this.out_ptr,this.out_len_ptr);if(0!=d)throw"speex_resampler_process_interleaved_float failed: "+d;d=getValue(this.out_len_ptr,"i32")*this.channels;e=new Float32Array(d);e.set(HEAPF32.subarray(this.out_ptr>>2,(this.out_ptr>>2)+d));return e};a.prototype.destroy=function(){this.handle&&(_speex_resampler_destroy(this.handle),this.handle=0,_free(this.in_len_ptr),_free(this.out_len_ptr),this.in_ptr&&_free(this.in_ptr),this.out_ptr&&_free(this.out_ptr),this.in_len_ptr=this.out_len_ptr=
this.in_ptr=this.out_ptr=0)};a.prototype._from_i8=function(d,a,f){new Int8Array(d)};a.prototype._from_i16=function(d,a,f){d=new Int16Array(d);var c=this.in_ptr>>2;if(0<=a)for(var g=this.channels,b=0;b<f;++b)HEAPF32[c+b]=d[b*g+a]/32768;else for(b=0;b<f;++b)HEAPF32[c+b]=d[b]/32768};a.prototype._from_i24=function(d,a,f){new Uint8Array(d)};a.prototype._from_i32=function(d,a,f){new Int32Array(d)};a.prototype._from_f32=function(a,e,f){a=new Float32Array(a);var c=this.in_ptr>>2;if(0<=e)for(var g=this.channels,
b=0;b<f;++b)HEAPF32[c+b]=a[b*g+e];else for(b=0;b<f;++b)HEAPF32[c+b]=a[b]};return a}();
